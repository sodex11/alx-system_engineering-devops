<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Grade 12 Advanced Function  — 100-Question Objective Test</title>
<style>
  :root{
    --bg:#f6f7fb;--card:#fff;--ink:#111;--muted:#555;
    --ok:#155e75;--okbg:#e0f2fe;
    --bad:#7f1d1d;--badbg:#fee2e2;
    --accent:#0a7;--primary:#056;--border:#e5e7eb
  }
  *{box-sizing:border-box}
  body{font-family:Inter,Segoe UI,Arial,sans-serif;background:var(--bg);color:var(--ink);margin:0}
  header{background:linear-gradient(90deg,#056,#0a7);color:#fff;padding:18px 10px;text-align:center}
  header h1{margin:.1rem 0 .2rem;font-size:1.35rem}
  header .sub{opacity:.95;font-size:.95rem}
  main{max-width:980px;margin:14px auto;padding:10px}
  .meta{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin:10px 0 14px}
  label.name{font-weight:600}
  input[type="text"]{padding:.6rem;border-radius:8px;border:1px solid var(--border);width:320px;max-width:100%}
  #timer{margin-left:auto;font-weight:700;background:#fff;padding:.35rem .6rem;border-radius:8px;border:1px solid var(--border)}
  .nav-row{display:flex;gap:8px;align-items:center;justify-content:space-between;margin:.25rem 0 1rem}
  .nav-row .pager{display:flex;gap:8px}
  .btn{border:0;border-radius:10px;padding:.55rem .9rem;cursor:pointer}
  .btn.ghost{background:#fff;border:1px solid var(--border)}
  .btn.primary{background:var(--primary);color:#fff}
  .btn.accent{background:var(--accent);color:#fff}
  .questions{display:grid;gap:.85rem}
  .q{background:var(--card);padding:12px;border-radius:10px;border:1px solid var(--border);box-shadow:0 2px 6px rgba(10,10,20,.05)}
  .q h4{margin:.2rem 0 .55rem;font-size:1rem;line-height:1.35}
  .answers label{display:block;cursor:pointer;padding:.35rem .5rem;border-radius:8px;border:1px solid transparent}
  .answers input{margin-right:.45rem}
  .answers label:hover{background:#f8fafc}
  .correct{background:var(--okbg)!important;border-color:#bae6fd}
  .correct .tag{color:var(--ok);font-weight:700}
  .wrong{background:var(--badbg)!important;border-color:#fecaca}
  .wrong .tag{color:var(--bad);font-weight:700}
  .submit-wrap{display:flex;gap:12px;align-items:center;margin-top:14px}
  .submit-wrap .left{display:flex;gap:8px;align-items:center}
  #result{margin-top:10px;font-weight:700}
  .summary{background:#fff;border:1px dashed #cbd5e1;border-radius:10px;padding:10px;margin-top:10px}
  .summary h5{margin:.2rem 0 .4rem}
  footer{margin:2rem 0;text-align:center;color:var(--muted);font-size:.9rem}
  .note{color:#064e3b;font-size:.9rem}
  .warn{color:#7f1d1d;font-size:.9rem}
  @media(max-width:700px){.nav-row{flex-direction:column;align-items:stretch}.nav-row .pager{justify-content:space-between}}
</style>
</head>
<body>
<header>
  <h1>Grade 12 Advanced Function — Objective Test (100 Questions)</h1>
  <div class="sub">Sections A → D • 90 minutes • Continuous numbering</div>
</header>

<main>
  <form id="quizForm">
    <div class="meta">
      <label class="name">Student full name
        <input id="studentName" name="studentName" type="text" placeholder="Enter full name" required />
      </label>
      <div id="timer" aria-live="polite">Time left: 60:00</div>
    </div>

    <div class="nav-row" aria-label="navigation-not-submit">
      <div class="pager">
        <button type="button" class="btn ghost" id="toTop" aria-label="Go to top">↑ Top</button>
        <button type="button" class="btn ghost" id="toBottom" aria-label="Go to bottom">↓ Bottom</button>
      </div>
      <div class="pager">
        <button type="button" class="btn ghost" id="prevUnanswered" aria-label="Previous unanswered question">Previous Unanswered</button>
        <button type="button" class="btn ghost" id="nextUnanswered" aria-label="Next unanswered question">Next Unanswered</button>
      </div>
    </div>

    <section class="questions" id="questionsContainer"></section>

    <div class="submit-wrap">
      <div class="left">
        <button type="submit" class="btn primary" id="submitBtn">Submit answers</button>
        <span id="result" aria-live="polite"></span>
      </div>
    </div>

    <div id="breakdown" class="summary" hidden>
      <h5>Detailed feedback</h5>
      <div id="failedNumbers"></div>
      <hr>
      <ol id="failedList"></ol>
    </div>
  </form>
</main>

<footer>
  <div>Built for Grade 12 Advanced Function • Auto-sends only failed questions to teacher email.</div>
</footer>

<script>
/* =========================
   QUIZ DATA (100 MCQs)
   ========================= */
const questions = [
// ----- Polynomial Functions (1–50) -----
{q:"Which of the following is a polynomial function?", opts:["f(x) = x^3 - 4x + 7","f(x) = 2/x + 1","f(x) = √x + 2","f(x) = log(x)"], a:"f(x) = x^3 - 4x + 7"},
{q:"The degree of the polynomial f(x) = 7x^4 - 3x^2 + 5 is:", opts:["2","3","4","5"], a:"4"},
{q:"The leading coefficient of f(x) = -2x^5 + x^3 - 7 is:", opts:["-2","-7","5","1"], a:"-2"},
{q:"The y-intercept of f(x) = 3x^2 - 5x + 4 is:", opts:["3","-5","4","-4"], a:"4"},
{q:"If f(x) = (x - 2)(x + 3), what are the zeros of f(x)?", opts:["2 and -3","-2 and 3","3 and 2","-3 and -2"], a:"2 and -3"},
{q:"The multiplicity of zero x = 2 in f(x) = (x - 2)^3(x + 1) is:", opts:["1","2","3","4"], a:"3"},
{q:"A polynomial of degree 5 can have at most how many turning points?", opts:["3","4","5","6"], a:"4"},
{q:"Which end behaviour describes f(x) = -x^4 + 2x^2?", opts:["Rises left, rises right","Falls left, rises right","Falls left, falls right","Rises left, falls right"], a:"Falls left, falls right"},
{q:"The polynomial function f(x) = x^2(x - 3)(x + 2) has degree:", opts:["2","3","4","5"], a:"4"},
{q:"Which factor theorem statement is true?", opts:["If f(a)=0 then (x - a) is a factor of f(x)","If (x - a) divides f(x) then f(a)=1","If f(a)=1 then (x - a) is a factor","If f(0)=0 then (x+1) is a factor"], a:"If f(a)=0 then (x - a) is a factor of f(x)"},
{q:"The remainder when f(x)=2x^3-3x+5 is divided by (x-2) is:", opts:["1","3","5","7"], a:"7"},
{q:"The Rational Root Theorem gives possible roots of f(x)=2x^3-5x^2+x-3 as:", opts:["±1, ±3","±1/2, ±3/2, ±1, ±3","±1/3, ±3/2","±2, ±3"], a:"±1/2, ±3/2, ±1, ±3"},
{q:"If f(x)=(x-1)(x+1)(x-2), the y-intercept is:", opts:["1","-2","2","-2"], a:"2"},
{q:"If f(x)=x^4 - 16, which of the following is a factor?", opts:["x+4","x+2","x-3","x-5"], a:"x+4"},
{q:"The polynomial identity (x^2 - 4) = (x - 2)(x + 2) is an example of:", opts:["Difference of cubes","Difference of squares","Perfect square trinomial","Quadratic formula"], a:"Difference of squares"},
{q:"If f(x) = x^3 - 3x^2 - x + 3, which is a zero?", opts:["1","-1","3","-3"], a:"1"},
{q:"End behaviour of odd degree polynomial with positive leading coefficient:", opts:["Falls left, rises right","Rises left, falls right","Rises both ends","Falls both ends"], a:"Falls left, rises right"},
{q:"The graph of f(x) = (x - 2)^2 touches the x-axis at:", opts:["x = 2","x = -2","x = 0","x = 1"], a:"x = 2"},
{q:"If f(x)=2(x+1)^2(x-3), the zero x = -1 has multiplicity:", opts:["1","2","3","4"], a:"2"},
{q:"Which is NOT a polynomial?", opts:["3x^2 + 2x - 7","x^(-1) + 2","5x^3 - 4x","7"], a:"x^(-1) + 2"},
{q:"If f(x)=x^3+4x^2+5x+20, then -4 is:", opts:["Not a zero","A zero","A factor twice","A turning point"], a:"A zero"},
{q:"Which polynomial has exactly 3 real zeros?", opts:["x^2 + 4","x^3 - x","x^4 - 4","x^2 - 1"], a:"x^3 - x"},
{q:"Which factorization is correct?", opts:["x^3 + 8 = (x+2)(x^2 - 2x + 4)","x^3 - 8 = (x-2)(x^2 + 2x + 4)","x^2 - 9 = (x-3)(x+3)","All of the above"], a:"All of the above"},
{q:"The polynomial f(x)=x^5 has how many turning points?", opts:["5","4","3","2"], a:"4"},
{q:"If the degree is even and leading coefficient is positive, the end behaviour is:", opts:["Up both ends","Down both ends","Up left, down right","Down left, up right"], a:"Up both ends"},
{q:"The zeros of f(x)=x^2+5x+6 are:", opts:["-3 and -2","3 and 2","-6 and 1","None"], a:"-3 and -2"},
{q:"If f(x)=x^2+1, its graph:", opts:["Crosses x-axis","Never touches x-axis","Has zeros at ±1","Has 2 turning points"], a:"Never touches x-axis"},
{q:"The multiplicity of zero x=0 in f(x)=x^4(x+2) is:", opts:["1","2","3","4"], a:"4"},
{q:"The degree of f(x)=7 is:", opts:["0","1","7","None"], a:"0"},
{q:"Which statement about polynomials is false?", opts:["They have integer exponents","They are continuous everywhere","They can have fractional powers","They can be factored"], a:"They can have fractional powers"},
{q:"If f(x) has degree 6, maximum number of real zeros is:", opts:["3","4","6","5"], a:"6"},
{q:"Descartes’ Rule of Signs gives information about:", opts:["Exact zeros","Number of positive/negative real zeros","Turning points","Domain"], a:"Number of positive/negative real zeros"},
{q:"If f(x)=x^3+2x^2-5x-6, then synthetic division by (x+2) gives remainder:", opts:["0","-1","1","2"], a:"0"},
{q:"A polynomial function is symmetric about the origin if:", opts:["It is odd","It is even","It has degree 2","It has real zeros"], a:"It is odd"},
{q:"If f(x)=x^2(x-3), f(0) equals:", opts:["0","3","-3","9"], a:"0"},
{q:"The axis of symmetry of y = x^2 + 4x + 1 is:", opts:["x = 2","x = -2","x = 4","x = -4"], a:"x = -2"},
{q:"The discriminant of x^2 - 4x + 3 is:", opts:["0","1","4","16"], a:"4"},
{q:"If discriminant < 0, then:", opts:["Two real roots","One real root","Two complex roots","No roots"], a:"Two complex roots"},
{q:"The factor theorem is based on:", opts:["Remainder theorem","Division algorithm","Quadratic formula","Binomial theorem"], a:"Remainder theorem"},
{q:"The zero of f(x)=x^2-1 is:", opts:["1 only","-1 only","±1","0"], a:"±1"},
{q:"The turning point of y=x^2 is at:", opts:["(0,0)","(1,0)","(0,1)","(2,1)"], a:"(0,0)"},
{q:"The axis of symmetry of y=x^2 is:", opts:["x=0","y=0","x=1","y=1"], a:"x=0"},
{q:"The domain of a polynomial function is:", opts:["All real numbers","Positive numbers only","Negative numbers only","Depends on degree"], a:"All real numbers"},
{q:"The range of f(x)=x^2 is:", opts:["(-∞, ∞)","[0, ∞)","(-∞,0]","None"], a:"[0, ∞)"},
{q:"A polynomial of odd degree must have:", opts:["No real zero","At least one real zero","Complex zeros only","Zero constant"], a:"At least one real zero"},
{q:"The sum of zeros of f(x)=x^2+5x+6 is:", opts:["-5","5","-6","6"], a:"-5"},
{q:"The product of zeros of f(x)=x^2+5x+6 is:", opts:["-6","6","5","-5"], a:"6"},
{q:"Which describes the graph of odd degree polynomial with negative leading coefficient?", opts:["Rises left, falls right","Falls left, rises right","Rises both ends","Falls both ends"], a:"Rises left, falls right"},
{q:"The axis of symmetry of y=x^2-6x+5 is:", opts:["x=3","x=-3","x=5","x=-5"], a:"x=3"},

// ----- Rational Functions (51–100) -----
{q:"The domain of f(x) = 1/(x-2) is:", opts:["x ≠ 0","x ≠ 2","x > 0","x < 2"], a:"x ≠ 2"},
{q:"The vertical asymptote of f(x) = 1/(x+3) is:", opts:["x=0","x=-3","y=0","x=3"], a:"x=-3"},
{q:"The horizontal asymptote of f(x) = 1/x is:", opts:["x=0","y=0","y=1","x=1"], a:"y=0"},
{q:"If numerator degree < denominator degree, horizontal asymptote is:", opts:["y=0","x=0","none","y=1"], a:"y=0"},
{q:"If numerator and denominator have same degree, asymptote is:", opts:["y=ratio of leading coefficients","x=0","y=0","none"], a:"y=ratio of leading coefficients"},
{q:"If numerator degree > denominator degree by 1, the asymptote is:", opts:["vertical","horizontal","oblique/slant","none"], a:"oblique/slant"},
{q:"The domain of f(x)= (x+1)/(x^2-4) is:", opts:["x≠2, -2","x≠1","x≠0","All real numbers"], a:"x≠2, -2"},
{q:"The vertical asymptotes of f(x)= (x-3)/(x^2-9) are:", opts:["x=3,-3","x=0","x=±9","x=1"], a:"x=3,-3"},
{q:"If f(x)=(x^2-1)/(x-1), simplified form is:", opts:["x+1","x-1","x+2","x"], a:"x+1"},
{q:"The hole in f(x)=(x^2-1)/(x-1) occurs at:", opts:["x=0","x=1","x=-1","x=2"], a:"x=1"},
{q:"A rational function cannot have:", opts:["Vertical asymptote","Horizontal asymptote","Oblique asymptote","Circle asymptote"], a:"Circle asymptote"},
{q:"The graph of y=1/x has:", opts:["One branch","Two branches","Three branches","Four branches"], a:"Two branches"},
{q:"The symmetry of f(x)=1/x is:", opts:["Even","Odd","None","Both"], a:"Odd"},
{q:"The vertical asymptote of f(x)=(2x)/(x-5) is:", opts:["x=0","x=5","x=-5","y=2"], a:"x=5"},
{q:"The horizontal asymptote of f(x)=(2x)/(x-5) is:", opts:["y=0","y=2","y=1","x=2"], a:"y=2"},
{q:"If f(x)=(x^2+3x+2)/(x+1), vertical asymptote is:", opts:["x=-1","x=0","x=2","none"], a:"x=-1"},
{q:"The oblique asymptote of f(x)=(x^2+1)/(x-1) is:", opts:["y=x","y=x+1","y=x-1","y=0"], a:"y=x+1"},
{q:"The rational function f(x)=(x+2)/(x^2+1) has domain:", opts:["x≠-2","All real numbers","x≠±1","x>0"], a:"All real numbers"},
{q:"The range of f(x)=(x+2)/(x^2+1) includes:", opts:["All real numbers","Excludes y=0","Excludes y>1","Excludes y<-1"], a:"All real numbers"},
{q:"The intercept of f(x)=1/(x+1) at y-axis is:", opts:["1","0","-1","Undefined"], a:"1"},
{q:"If f(x)=(x^2-4)/(x-2), simplified f(x) is:", opts:["x-2","x+2","x^2-2","x-1"], a:"x+2"},
{q:"Hole in f(x)=(x^2-4)/(x-2) occurs at:", opts:["x=2","x=-2","x=0","None"], a:"x=2"},
{q:"The graph of f(x)=(x+1)/(x-1) has symmetry about:", opts:["Origin","x-axis","y-axis","Line y=x"], a:"Origin"},
{q:"Rational functions are undefined when:", opts:["Numerator=0","Denominator=0","Numerator<0","Denominator>0"], a:"Denominator=0"},
{q:"If degree numerator < degree denominator, graph approaches:", opts:["x-axis","y-axis","infinity","zero"], a:"x-axis"},
{q:"If degree numerator > degree denominator by 2, then:", opts:["Oblique asymptote","Quadratic asymptote","No asymptote","Circle"], a:"Quadratic asymptote"},
{q:"Which rational function has no vertical asymptote?", opts:["1/x","1/(x+1)","(x^2+1)/(x+2)","(x-1)/(x-1)"], a:"(x-1)/(x-1)"},
{q:"The graph of y=1/x^2 lies:", opts:["Above x-axis","Below x-axis","Both sides","On x-axis"], a:"Above x-axis"},
{q:"The vertical asymptote of f(x)=1/x^2 is:", opts:["x=0","y=0","y=1","x=1"], a:"x=0"},
{q:"The horizontal asymptote of f(x)=1/x^2 is:", opts:["y=0","y=1","x=0","x=1"], a:"y=0"},
{q:"The graph of y=1/x^2 is symmetric about:", opts:["x-axis","y-axis","origin","line y=x"], a:"y-axis"},
{q:"If f(x)=(2x+1)/(x^2+1), vertical asymptotes are:", opts:["x=±1","x=0","None","x=2"], a:"None"},
{q:"Which rational function has a slant asymptote?", opts:["(x^2+1)/(x-1)","1/(x^2+1)","1/(x+1)","(x+1)/(x^2+1)"], a:"(x^2+1)/(x-1)"},
{q:"If f(x)=1/(x-4), domain excludes:", opts:["x=0","x=4","x=-4","x=2"], a:"x=4"},
{q:"If f(x)=(x-2)/(x^2-1), vertical asymptotes are:", opts:["x=±1","x=0","x=2","none"], a:"x=±1"},
{q:"The rational function f(x)=(x^2-9)/(x-3) simplifies to:", opts:["x+3","x-3","x+2","x-2"], a:"x+3"},
{q:"The hole in f(x)=(x^2-9)/(x-3) is at:", opts:["x=0","x=3","x=-3","None"], a:"x=3"},
{q:"The function f(x)=(x^2+1)/(x^2+2) has horizontal asymptote:", opts:["y=0","y=1","y=2","none"], a:"y=1"},
{q:"The vertical asymptote of f(x)=(x^2+1)/(x^2-4) is:", opts:["x=±2","x=0","y=0","x=±1"], a:"x=±2"},
{q:"The rational function f(x)=(2x^3)/(x^2+1) has:", opts:["Oblique asymptote","Quadratic asymptote","Vertical asymptote","No asymptote"], a:"Oblique asymptote"},
{q:"The rational function (x^2+2x+1)/(x+1) has:", opts:["Hole at x=-1","Asymptote at x=-1","No intercept","None"], a:"Hole at x=-1"},
{q:"The oblique asymptote of f(x)=(x^3+1)/(x^2+1) is:", opts:["y=x","y=x+1","y=x-1","y=0"], a:"y=x"},
{q:"For f(x)=(x^2-1)/(x^2+1), horizontal asymptote is:", opts:["y=1","y=0","y=-1","none"], a:"y=1"},
{q:"The rational function (x^2+4)/(x^2-4) has vertical asymptotes at:", opts:["x=±2","x=±4","x=0","none"], a:"x=±2"},
{q:"The rational function (5x^2-3)/(2x^2+7) has horizontal asymptote:", opts:["y=5/2","y=2/5","y=7/5","y=0"], a:"y=5/2"},
{q:"The rational function (x^2-4x+3)/(x-3) has:", opts:["Hole at x=3","Vertical asymptote at x=3","Oblique asymptote","Horizontal asymptote"], a:"Hole at x=3"},
{q:"For f(x)=1/(x^2), as x→∞, f(x) approaches:", opts:["0","∞","1","-∞"], a:"0"},
{q:"For f(x)=1/(x^2), as x→0, f(x) approaches:", opts:["∞","0","-∞","1"], a:"∞"},
{q:"The graph of f(x)=(x^2-1)/(x^2-4) has vertical asymptotes at:", opts:["x=±2","x=±1","x=0","None"], a:"x=±2"}
];

  

/* =========================
   DOM BUILD
   ========================= */
const container = document.getElementById('questionsContainer');
questions.forEach((Q, i) => {
  const number = i + 1;
  const div = document.createElement('div');
  div.className = 'q';
  const h = document.createElement('h4');
  h.textContent = `${number}. ${Q.q}`;
  div.appendChild(h);

  const ans = document.createElement('div');
  ans.className = 'answers';
  Q.opts.forEach(opt => {
    const id = `q${i}-${sanitizeId(opt)}`;
    const lbl = document.createElement('label');
    lbl.setAttribute('for', id);
    const radio = document.createElement('input');
    radio.type='radio'; radio.name=`q${i}`; radio.value=opt; radio.id=id; radio.required=true;
    lbl.appendChild(radio);
    lbl.appendChild(document.createTextNode(' ' + opt));
    ans.appendChild(lbl);
  });
  div.appendChild(ans);
  container.appendChild(div);
});
function sanitizeId(s){ return s.replace(/[^a-z0-9]+/gi,'-'); }

/* =========================
   TIMER (90 minutes)
   ========================= */
let timeLeft = 60 * 60; // seconds
const timerEl = document.getElementById('timer');
const timerInterval = setInterval(()=>{
  if(timeLeft <= 0){
    clearInterval(timerInterval);
    timerEl.textContent = 'Time left: 00:00';
    document.getElementById('quizForm').requestSubmit();
    return;
  }
  const m = Math.floor(timeLeft/60).toString().padStart(2,'0');
  const s = (timeLeft%60).toString().padStart(2,'0');
  timerEl.textContent = `Time left: ${m}:${s}`;
  timeLeft--;
}, 1000);

/* =========================
   NAV CONTROLS
   ========================= */
document.getElementById('toTop').onclick = ()=>window.scrollTo({top:0,behavior:'smooth'});
document.getElementById('toBottom').onclick = ()=>window.scrollTo({top:document.body.scrollHeight,behavior:'smooth'});

function firstUnansweredIndex(step=+1){
  const total = questions.length;
  const qs = [...document.querySelectorAll('.q')];
  const mid = window.scrollY + window.innerHeight/2;
  let near = 0;
  qs.forEach((el,idx)=>{
    const r = el.getBoundingClientRect();
    const y = r.top + window.scrollY;
    if (y < mid) near = idx;
  });
  for(let k=1;k<=total;k++){
    const i = ((near + step*k) % total + total) % total;
    if(!document.querySelector(`input[name="q${i}"]:checked`)) return i;
  }
  return -1;
}
document.getElementById('nextUnanswered').onclick = ()=>{
  const idx = firstUnansweredIndex(+1);
  if(idx>=0) document.querySelectorAll('.q')[idx].scrollIntoView({behavior:'smooth',block:'center'});
};
document.getElementById('prevUnanswered').onclick = ()=>{
  const idx = firstUnansweredIndex(-1);
  if(idx>=0) document.querySelectorAll('.q')[idx].scrollIntoView({behavior:'smooth',block:'center'});
};

/* =========================
   SUBMIT / SCORE / FEEDBACK
   ========================= */
const form = document.getElementById('quizForm');
const result = document.getElementById('result');
const breakdown = document.getElementById('breakdown');
const failedNumbersEl = document.getElementById('failedNumbers');
const failedListEl = document.getElementById('failedList');

form.addEventListener('submit', async (e)=>{
  e.preventDefault();
  clearInterval(timerInterval);

  const name = document.getElementById('studentName').value.trim();
  if(!name){ alert('Please enter student name'); return; }

  const ok = confirm('Are you sure you want to submit your answers?');
  if(!ok) return;

  const formData = new FormData(form);
  let score = 0;
  const wrongs = [];
  const failedNumbers = [];

  document.querySelectorAll('.answers label').forEach(l => l.classList.remove('correct','wrong'));

  for(let i=0;i<questions.length;i++){
    const given = formData.get(`q${i}`);
    const correct = questions[i].a;
    const labels = [...document.querySelectorAll(`input[name="q${i}"]`)].map(inp=>inp.parentElement);

    labels.forEach(lbl=>{
      if(lbl.querySelector('input').value === correct){
        addTag(lbl,'Correct');
        lbl.classList.add('correct');
      }
    });

    if(given === correct){
      score++;
    }else{
      failedNumbers.push(i+1);
      const wrongLabel = document.querySelector(`input[name="q${i}"]:checked`)?.parentElement;
      if(wrongLabel){
        addTag(wrongLabel,'Your choice');
        wrongLabel.classList.add('wrong');
      }
      wrongs.push({number: i+1, question: questions[i].q, your_answer: given ?? "(no answer)", correct_answer: correct});
    }
  }

  result.textContent = `${name}: You scored ${score} / ${questions.length}.`;

  if(wrongs.length){
    breakdown.hidden = false;
    failedNumbersEl.textContent = `You missed these question numbers: ${failedNumbers.join(', ')}.`;
    failedListEl.innerHTML = '';
    wrongs.forEach(w=>{
      const li = document.createElement('li');
      li.innerHTML = `<strong>Q${w.number}.</strong> ${escapeHtml(w.question)}<br>
        <em>Your answer:</em> ${escapeHtml(w.your_answer)}<br>
        <em>Correct answer:</em> ${escapeHtml(w.correct_answer)}`;
      failedListEl.appendChild(li);
    });
  }else{
    breakdown.hidden = false;
    failedNumbersEl.textContent = 'Perfect! You did not miss any question.';
    failedListEl.innerHTML = '';
  }

  try {
    await fetch('https://formspree.io/f/mvgqwywl', {
      method:'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({
        subject: `Basic Science Quiz — ${name} — ${score}/${questions.length}`,
        message: `Student: ${name}\nScore: ${score}/${questions.length}\nFailed numbers: ${failedNumbers.join(', ') || 'None'}`,
        wrongs
      })
    });
    const note = document.createElement('div');
    note.className='note';
    note.textContent = 'Only the failed questions have been sent to the teacher email.';
    result.appendChild(document.createElement('br'));
    result.appendChild(note);
  } catch(err) {
    const warn = document.createElement('div');
    warn.className='warn';
    warn.textContent = 'Could not send results to email (network/CORS). Your score and feedback are shown above.';
    result.appendChild(document.createElement('br'));
    result.appendChild(warn);
  }
});
function addTag(label, text){
  if(label.querySelector('.tag')) return;
  const span = document.createElement('span');
  span.className = 'tag';
  span.style.marginLeft = '6px';
  span.textContent = `(${text})`;
  label.appendChild(span);
}
form.addEventListener('invalid', function(ev){
  ev.preventDefault();
  for(let i=0;i<questions.length;i++){
    if(!document.querySelector(`input[name="q${i}"]:checked`)){
      const el = document.querySelector(`input[name="q${i}"]`);
      if(el){ el.scrollIntoView({behavior:'smooth',block:'center'}); el.focus(); }
      break;
    }
  }
}, true);
function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
</script>
</body>
</html>
