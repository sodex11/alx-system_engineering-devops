<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>JS3 Basic Science — 100-Question Objective Test</title>
<style>
  :root{
    --bg:#f6f7fb;--card:#fff;--ink:#111;--muted:#555;
    --ok:#155e75;--okbg:#e0f2fe;
    --bad:#7f1d1d;--badbg:#fee2e2;
    --accent:#0a7;--primary:#056;--border:#e5e7eb
  }
  *{box-sizing:border-box}
  body{font-family:Inter,Segoe UI,Arial,sans-serif;background:var(--bg);color:var(--ink);margin:0}
  header{background:linear-gradient(90deg,#056,#0a7);color:#fff;padding:18px 10px;text-align:center}
  header h1{margin:.1rem 0 .2rem;font-size:1.35rem}
  header .sub{opacity:.95;font-size:.95rem}
  main{max-width:980px;margin:14px auto;padding:10px}
  .meta{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin:10px 0 14px}
  label.name{font-weight:600}
  input[type="text"]{padding:.6rem;border-radius:8px;border:1px solid var(--border);width:320px;max-width:100%}
  #timer{margin-left:auto;font-weight:700;background:#fff;padding:.35rem .6rem;border-radius:8px;border:1px solid var(--border)}
  .nav-row{display:flex;gap:8px;align-items:center;justify-content:space-between;margin:.25rem 0 1rem}
  .nav-row .pager{display:flex;gap:8px}
  .btn{border:0;border-radius:10px;padding:.55rem .9rem;cursor:pointer}
  .btn.ghost{background:#fff;border:1px solid var(--border)}
  .btn.primary{background:var(--primary);color:#fff}
  .btn.accent{background:var(--accent);color:#fff}
  .questions{display:grid;gap:.85rem}
  .q{background:var(--card);padding:12px;border-radius:10px;border:1px solid var(--border);box-shadow:0 2px 6px rgba(10,10,20,.05)}
  .q h4{margin:.2rem 0 .55rem;font-size:1rem;line-height:1.35}
  .answers label{display:block;cursor:pointer;padding:.35rem .5rem;border-radius:8px;border:1px solid transparent}
  .answers input{margin-right:.45rem}
  .answers label:hover{background:#f8fafc}
  .correct{background:var(--okbg)!important;border-color:#bae6fd}
  .correct .tag{color:var(--ok);font-weight:700}
  .wrong{background:var(--badbg)!important;border-color:#fecaca}
  .wrong .tag{color:var(--bad);font-weight:700}
  .submit-wrap{display:flex;gap:12px;align-items:center;margin-top:14px}
  .submit-wrap .left{display:flex;gap:8px;align-items:center}
  #result{margin-top:10px;font-weight:700}
  .summary{background:#fff;border:1px dashed #cbd5e1;border-radius:10px;padding:10px;margin-top:10px}
  .summary h5{margin:.2rem 0 .4rem}
  footer{margin:2rem 0;text-align:center;color:var(--muted);font-size:.9rem}
  .note{color:#064e3b;font-size:.9rem}
  .warn{color:#7f1d1d;font-size:.9rem}
  @media(max-width:700px){.nav-row{flex-direction:column;align-items:stretch}.nav-row .pager{justify-content:space-between}}
</style>
</head>
<body>
<header>
  <h1>JS3 Basic Science — Objective Test (100 Questions)</h1>
  <div class="sub">Sections A → D • 90 minutes • Continuous numbering</div>
</header>

<main>
  <form id="quizForm">
    <div class="meta">
      <label class="name">Student full name
        <input id="studentName" name="studentName" type="text" placeholder="Enter full name" required />
      </label>
      <div id="timer" aria-live="polite">Time left: 90:00</div>
    </div>

    <div class="nav-row" aria-label="navigation-not-submit">
      <div class="pager">
        <button type="button" class="btn ghost" id="toTop">↑ Top</button>
        <button type="button" class="btn ghost" id="toBottom">↓ Bottom</button>
      </div>
      <div class="pager">
        <button type="button" class="btn ghost" id="prevUnanswered">Previous Unanswered</button>
        <button type="button" class="btn ghost" id="nextUnanswered">Next Unanswered</button>
      </div>
    </div>

    <section class="questions" id="questionsContainer"></section>

    <div class="submit-wrap">
      <div class="left">
        <button type="submit" class="btn primary" id="submitBtn">Submit answers</button>
        <span id="result" aria-live="polite"></span>
      </div>
    </div>

    <div id="breakdown" class="summary" hidden>
      <h5>Detailed feedback</h5>
      <div id="failedNumbers"></div>
      <ol id="failedList"></ol>
    </div>
  </form>
</main>

<footer>
  <div>Built for JS3 Basic Science • Auto-sends only failed questions to teacher email.</div>
</footer>

<script>
/* =========================
   QUIZ DATA (100 MCQs)
   ========================= */

const questions = [
{q:"Which natural source of light is most important to Earth?", opts:["Moon","Sun","Fire","Stars"], a:"Sun"},
{q:"What type of energy is produced by the Sun?", opts:["Chemical","Nuclear","Sound","Electrical"], a:"Nuclear"},
{q:"The moon shines because:", opts:["It produces its own light","It reflects sunlight","It burns gases","It is hot"], a:"It reflects sunlight"},
{q:"Artificial sources of light include:", opts:["Sun","Stars","Electric bulb","Moon"], a:"Electric bulb"},
{q:"Which of the following is NOT a luminous object?", opts:["Torch","Table","Candle","Lamp"], a:"Table"},
{q:"Which of these travels fastest?", opts:["Sound","Light","Car","Wind"], a:"Light"},
{q:"Light travels in:", opts:["Curved lines","Straight lines","Zigzag lines","Circular path"], a:"Straight lines"},
{q:"The speed of light in air is approximately:", opts:["3 × 10⁸ m/s","3 × 10⁶ m/s","1.5 × 10³ m/s","300 m/s"], a:"3 × 10⁸ m/s"},
{q:"When light is blocked by an opaque object, it forms:", opts:["Shadow","Reflection","Refraction","Image"], a:"Shadow"},
{q:"The dark region of a shadow is called:", opts:["Penumbra","Umbra","Halo","Focus"], a:"Umbra"},
{q:"The lighter part of a shadow is called:", opts:["Umbra","Penumbra","Focus","Image"], a:"Penumbra"},
{q:"Shadows are longest at what time of the day?", opts:["Morning and evening","Afternoon","Midnight","Noon"], a:"Morning and evening"},
{q:"The property of light that explains how shadows are formed is:", opts:["It travels in straight lines","It bends","It is heavy","It is slow"], a:"It travels in straight lines"},
{q:"A plane mirror forms an image that is:", opts:["Virtual and erect","Real and inverted","Magnified","Upside down"], a:"Virtual and erect"},
{q:"Which of these is NOT a use of a plane mirror?", opts:["Periscope","Decoration","To form solar energy","To see ourselves"], a:"To form solar energy"},
{q:"The bouncing back of light from a surface is called:", opts:["Refraction","Reflection","Diffusion","Dispersion"], a:"Reflection"},
{q:"The angle between the incident ray and the mirror is called:", opts:["Angle of incidence","Angle of reflection","Angle of deviation","Refractive index"], a:"Angle of incidence"},
{q:"According to the law of reflection:", opts:["i = r","i > r","i < r","i = 2r"], a:"i = r"},
{q:"The bending of light as it passes from one medium to another is called:", opts:["Reflection","Refraction","Dispersion","Diffusion"], a:"Refraction"},
{q:"Light bends because:", opts:["It changes medium","It slows down or speeds up","It is reflected","It is scattered"], a:"It slows down or speeds up"},
{q:"A glass prism splits white light into:", opts:["Two rays","Seven colours","Three colours","One ray"], a:"Seven colours"},
{q:"The band of colours formed from white light is called:", opts:["Rainbow","Spectrum","Diffraction","Reflection"], a:"Spectrum"},
{q:"The colours of the rainbow are arranged in:", opts:["2","5","7","9"], a:"7"},
{q:"The first colour of the rainbow is:", opts:["Blue","Red","Green","Violet"], a:"Red"},
{q:"The last colour of the rainbow is:", opts:["Red","Blue","Violet","Orange"], a:"Violet"},
{q:"The instrument used to split white light is:", opts:["Mirror","Lens","Prism","Concave mirror"], a:"Prism"},
{q:"The splitting of white light into seven colours is called:", opts:["Dispersion","Reflection","Refraction","Absorption"], a:"Dispersion"},
{q:"The image formed by a pinhole camera is:", opts:["Real, inverted, smaller","Virtual, erect","Real, upright","Magnified"], a:"Real, inverted, smaller"},
{q:"Which device works on the principle of a pinhole camera?", opts:["Mirror","Eye","Telescope","Magnifying glass"], a:"Eye"},
{q:"The human eye forms images on the:", opts:["Cornea","Lens","Retina","Pupil"], a:"Retina"},
{q:"The coloured part of the eye is called:", opts:["Pupil","Iris","Lens","Cornea"], a:"Iris"},
{q:"The transparent front part of the eye is:", opts:["Lens","Cornea","Pupil","Retina"], a:"Cornea"},
{q:"The black opening in the eye is:", opts:["Retina","Lens","Pupil","Cornea"], a:"Pupil"},
{q:"The eye lens is a:", opts:["Concave lens","Convex lens","Plane mirror","Prism"], a:"Convex lens"},
{q:"The defect where far objects cannot be seen clearly is:", opts:["Myopia","Hypermetropia","Astigmatism","Blindness"], a:"Myopia"},
{q:"Myopia can be corrected using:", opts:["Concave lens","Convex lens","Prism","Mirror"], a:"Concave lens"},
{q:"The defect where near objects cannot be seen clearly is:", opts:["Hypermetropia","Myopia","Astigmatism","Colour blindness"], a:"Hypermetropia"},
{q:"Hypermetropia can be corrected using:", opts:["Concave lens","Convex lens","Mirror","Prism"], a:"Convex lens"},
{q:"The scattering of light by tiny particles makes the sky appear:", opts:["Green","Red","Blue","Yellow"], a:"Blue"},
{q:"At sunset and sunrise the sky appears red because:", opts:["Scattering of longer wavelength","Absorption","Reflection","Refraction"], a:"Scattering of longer wavelength"},
{q:"An instrument used to view distant objects is:", opts:["Microscope","Telescope","Periscope","Camera"], a:"Telescope"},
{q:"An instrument used to see tiny objects is:", opts:["Camera","Microscope","Binoculars","Kaleidoscope"], a:"Microscope"},
{q:"Which instrument uses two plane mirrors set parallel?", opts:["Microscope","Periscope","Camera","Prism"], a:"Periscope"},
{q:"Light rays from the Sun reach the Earth in about:", opts:["8 minutes","1 second","1 hour","24 hours"], a:"8 minutes"},
{q:"The scientist who measured the speed of light was:", opts:["Newton","Einstein","Römer","Galileo"], a:"Römer"},
{q:"A convex lens can form a:", opts:["Real or virtual image","Only real image","Only virtual image","No image"], a:"Real or virtual image"},
{q:"A concave lens always forms an image that is:", opts:["Real","Virtual, erect, diminished","Magnified","Inverted"], a:"Virtual, erect, diminished"},
{q:"Which part of the eye controls the amount of light entering?", opts:["Lens","Cornea","Iris","Retina"], a:"Iris"},
{q:"Which part of the eye is sensitive to light?", opts:["Pupil","Retina","Iris","Cornea"], a:"Retina"},
{q:"When light passes through a concave lens, it:", opts:["Converges","Diverges","Forms rainbow","Splits"], a:"Diverges"},
{q:"When light passes through a convex lens, it:", opts:["Diverges","Converges","Reflects","Spreads"], a:"Converges"},
{q:"The unit of light intensity is:", opts:["Watt","Candela","Newton","Lumen"], a:"Candela"},
{q:"Which colour of light has the shortest wavelength?", opts:["Red","Green","Blue","Violet"], a:"Violet"},
{q:"Which colour has the longest wavelength?", opts:["Red","Yellow","Blue","Violet"], a:"Red"},
{q:"Light is a form of:", opts:["Chemical energy","Heat energy","Electromagnetic wave","Potential energy"], a:"Electromagnetic wave"},
{q:"Which of the following is NOT an optical instrument?", opts:["Periscope","Telescope","Microscope","Stethoscope"], a:"Stethoscope"},
{q:"Which part of the eye focuses light?", opts:["Iris","Lens","Retina","Cornea"], a:"Lens"},
{q:"The lens of the eye becomes cloudy in:", opts:["Astigmatism","Cataract","Myopia","Glaucoma"], a:"Cataract"},
{q:"The absence of lens in the eye leads to:", opts:["Clear vision","Blindness","Astigmatism","Colour vision"], a:"Blindness"},
{q:"Which scientist explained the particle nature of light?", opts:["Newton","Einstein","Römer","Hooke"], a:"Einstein"},
{q:"Which scientist explained light as a wave?", opts:["Huygens","Einstein","Newton","Darwin"], a:"Huygens"},
{q:"The rainbow is caused by:", opts:["Dispersion, reflection and refraction","Only reflection","Only refraction","Only scattering"], a:"Dispersion, reflection and refraction"},
{q:"The eye is similar in principle to:", opts:["Periscope","Camera","Microscope","Mirror"], a:"Camera"},
{q:"Which device is used to protect the eyes from bright light?", opts:["Periscope","Sunglasses","Microscope","Prism"], a:"Sunglasses"},
{q:"Which type of lens is used in magnifying glasses?", opts:["Concave","Convex","Plane","Cylindrical"], a:"Convex"},
{q:"The splitting of light into its component colours shows that light is:", opts:["Monochromatic","Polychromatic","Transparent","Opaque"], a:"Polychromatic"},
{q:"Which of these is an application of reflection of light?", opts:["Rainbow","Echo","Mirror","Spectrum"], a:"Mirror"},
{q:"Which type of mirror is used by dentists?", opts:["Plane mirror","Concave mirror","Convex mirror","Prism"], a:"Concave mirror"},
{q:"The unit of frequency of light is:", opts:["Hertz","Newton","Candela","Metre"], a:"Hertz"},
{q:"Light rays cannot bend around corners because:", opts:["It is heavy","It travels in straight lines","It is slow","It is opaque"], a:"It travels in straight lines"},
{q:"An example of a natural source of light is:", opts:["Torch","Lamp","Candle","Firefly"], a:"Firefly"},
{q:"An example of a bioluminescent organism is:", opts:["Dog","Firefly","Fish","Cat"], a:"Firefly"},
{q:"The eye defect caused by old age is:", opts:["Myopia","Hypermetropia","Presbyopia","Cataract"], a:"Presbyopia"},
{q:"Which optical instrument uses reflection inside a tube to see around obstacles?", opts:["Telescope","Microscope","Periscope","Camera"], a:"Periscope"},
{q:"In refraction, when light moves from air to glass, it bends:", opts:["Away from normal","Towards normal","Does not bend","At right angle"], a:"Towards normal"},
{q:"When light moves from glass to air, it bends:", opts:["Towards normal","Away from normal","Does not bend","No refraction"], a:"Away from normal"},
{q:"The least deviated colour in dispersion is:", opts:["Red","Blue","Green","Violet"], a:"Red"},
{q:"The most deviated colour in dispersion is:", opts:["Red","Blue","Green","Violet"], a:"Violet"},
{q:"Which part of the eye regulates the size of the pupil?", opts:["Lens","Cornea","Iris","Retina"], a:"Iris"},
{q:"The white part of the eye is called:", opts:["Retina","Sclera","Cornea","Lens"], a:"Sclera"},
{q:"What is the scientific study of light called?", opts:["Acoustics","Optics","Mechanics","Dynamics"], a:"Optics"},
{q:"Which scientist discovered that white light is made of seven colours?", opts:["Einstein","Newton","Galileo","Hooke"], a:"Newton"},
  {q:"Which scientist discovered that white light is made of seven colours?", opts:["Einstein","Newton","Galileo","Hooke"], a:"Newton"},
{q:"Which type of galaxy is the Milky Way?", opts:["Spiral","Elliptical","Irregular","Cubic"], a:"Spiral"},
{q:"Galaxies are held together by:", opts:["Heat","Magnetic force","Gravity","Wind"], a:"Gravity"},
{q:"The Milky Way would take about how many years to cross at the speed of light?", opts:["10,000","100,000","1,000,000","1 billion"], a:"100,000"},
{q:"The nearest known galaxy to the Milky Way is:", opts:["Orion","Canis Major Dwarf","Andromeda","Sagittarius"], a:"Canis Major Dwarf"},
{q:"The estimated number of galaxies in the Universe is about:", opts:["100 million","1 billion","10 billion","100 billion"], a:"100 billion"},
{q:"The word 'galaxy' comes from the Greek word meaning:", opts:["Sun","Star","Milky","Universe"], a:"Milky"},
{q:"True or False: The Milky Way contains about 250 billion stars.", opts:["True","False"], a:"True"},
{q:"Which of these is NOT a type of galaxy?", opts:["Spiral","Irregular","Elliptical","Cubic"], a:"Cubic"},
{q:"True or False: Scientists know the exact number of stars in the Milky Way.", opts:["True","False"], a:"False"},
{q:"Asteroids are mainly made of:", opts:["Gas","Rock","Water","Dust"], a:"Rock"},
{q:"The first asteroid discovered was:", opts:["Pallas","Ceres","Vesta","Itokawa"], a:"Ceres"},
{q:"Ceres was discovered in which year?", opts:["1701","1801","1901","2001"], a:"1801"},
{q:"The largest asteroid in the asteroid belt is:", opts:["Vesta","Pallas","Ceres","Itokawa"], a:"Ceres"},
{q:"The smallest studied asteroid is about:", opts:["975 km","2 m","530 m","250 km"], a:"2 m"},
{q:"The Japanese spacecraft that visited asteroid Itokawa was:", opts:["Hayabusa","Cassini","Voyager","Apollo"], a:"Hayabusa"},
{q:"Tidal forces can change the shape of an asteroid when it:", opts:["Spins slowly","Passes near a planet","Orbits normally","Collides with Earth"], a:"Passes near a planet"},
{q:"Most small asteroids do what when entering Earth's atmosphere?", opts:["Reach Earth’s surface","Break up in the atmosphere","Orbit the Moon","Burn inside volcanoes"], a:"Break up in the atmosphere"},
{q:"Scientists think a large asteroid impacts Earth roughly every:", opts:["1,300 years","13,000 years","130,000 years","1,300,000 years"], a:"100,000 years"},
{q:"Asteroids impact Earth mainly because of:", opts:["Earth’s tilt","Earth’s gravity and nearby orbits","Earth’s rotation","Earth’s oceans"], a:"Earth’s gravity and nearby orbits"},
{q:"Which of these is a primary colour of light?", opts:["Red","Green","Blue","All of the above"], a:"All of the above"},
{q:"Which is NOT a primary colour of light?", opts:["Red","Green","Blue","Yellow"], a:"Yellow"},
{q:"The colour seen when red and green lights overlap is:", opts:["Cyan","Yellow","Magenta","Violet"], a:"Yellow"},
{q:"The colour seen when blue and red lights overlap is:", opts:["Cyan","Magenta","Yellow","Orange"], a:"Magenta"},
{q:"The colour seen when green and blue lights overlap is:", opts:["Cyan","White","Red","Magenta"], a:"Cyan"},
{q:"A T-shirt looks red because it:", opts:["Emits red light","Reflects red and absorbs other colours","Absorbs red only","Is transparent"], a:"Reflects red and absorbs other colours"},
{q:"In traffic lights, a red filter allows only:", opts:["Yellow light","White light","Red light","Green light"], a:"Red light"},
{q:"A black object appears black because it:", opts:["Reflects all colours","Absorbs all colours","Emits black light","Is transparent"], a:"Absorbs all colours"},
{q:"White light is obtained by mixing:", opts:["Red + Blue","Red + Green","Green + Blue","All three primary colours"], a:"All three primary colours"},
{q:"A flower appears yellow because it:", opts:["Reflects only yellow light","Emits yellow light","Absorbs yellow light","Reflects all colours"], a:"Reflects only yellow light"},
{q:"The 'broken pencil in water' effect is due to:", opts:["Reflection","Refraction","Dispersion","Absorption"], a:"Refraction"},
{q:"The rainbow is caused by:", opts:["Reflection inside water drops + Dispersion","Only Reflection","Only Refraction","Only Scattering"], a:"Reflection inside water drops + Dispersion"},
{q:"Violet light bends more than red light because it:", opts:["Has higher speed in glass","Has lower speed in glass","Travels faster in water","Is weaker"], a:"Has lower speed in glass"},
{q:"The normal line in ray diagrams is drawn at:", opts:["60° to the surface","45° to the surface","90° to the surface","Parallel to the surface"], a:"90° to the surface"},
{q:"The angle of incidence is equal to the:", opts:["Angle of deviation","Angle of reflection","Angle of refraction","Angle of absorption"], a:"Angle of reflection"},
{q:"In refraction, when light enters from air to glass it bends:", opts:["Towards the normal","Away from the normal","Does not bend","Randomly"], a:"Towards the normal"},
{q:"When light exits glass into air it bends:", opts:["Towards the normal","Away from the normal","Does not bend","At right angle"], a:"Away from the normal"},
{q:"The bending of light makes objects in water appear:", opts:["Larger","Smaller","Shifted from true position","Invisible"], a:"Shifted from true position"},
{q:"The angle of refraction is measured from:", opts:["The mirror surface","The boundary line","The normal","The incident ray"], a:"The normal"},
{q:"The band of colours seen in a rainbow is called:", opts:["Spectrum","Diffraction","Reflection","Scattering"], a:"Spectrum"},
{q:"The least deviated colour in dispersion is:", opts:["Red","Blue","Green","Violet"], a:"Red"},
{q:"The most deviated colour in dispersion is:", opts:["Red","Blue","Green","Violet"], a:"Violet"},
{q:"The number of colours in a rainbow is:", opts:["5","6","7","8"], a:"7"},
{q:"The first colour at the top of the rainbow is:", opts:["Blue","Red","Green","Violet"], a:"Red"},
{q:"The last colour at the bottom of the rainbow is:", opts:["Red","Blue","Violet","Orange"], a:"Violet"},
{q:"The scientist who split white light into colours using a prism was:", opts:["Einstein","Newton","Galileo","Darwin"], a:"Newton"},
{q:"The splitting of white light into different colours is called:", opts:["Dispersion","Diffusion","Scattering","Refraction"], a:"Dispersion"},
{q:"The unit of frequency of light is:", opts:["Newton","Candela","Hertz","Metre"], a:"Hertz"},
{q:"Light is a form of:", opts:["Chemical energy","Heat energy","Electromagnetic wave","Potential energy"], a:"Electromagnetic wave"},
{q:"Which colour of light has the shortest wavelength?", opts:["Red","Green","Blue","Violet"], a:"Violet"},
{q:"Which colour of light has the longest wavelength?", opts:["Red","Yellow","Blue","Violet"], a:"Red"}
];
/* =========================
   DOM BUILD
   ========================= */
const container = document.getElementById('questionsContainer');

questions.forEach((Q, i) => {
  const number = i + 1;
  const div = document.createElement('div');
  div.className = 'q';
  const h = document.createElement('h4');
  h.textContent = `${number}. ${Q.q}`;
  div.appendChild(h);

  const ans = document.createElement('div');
  ans.className = 'answers';
  Q.opts.forEach(opt => {
    const id = `q${i}-${sanitizeId(opt)}`;
    const lbl = document.createElement('label');
    lbl.setAttribute('for', id);
    const radio = document.createElement('input');
    radio.type='radio'; radio.name=`q${i}`; radio.value=opt; radio.id=id; radio.required=true;
    lbl.appendChild(radio);
    lbl.appendChild(document.createTextNode(' ' + opt));
    ans.appendChild(lbl);
  });
  div.appendChild(ans);
  container.appendChild(div);
});

function sanitizeId(s){ return s.replace(/[^a-z0-9]+/gi,'-'); }

/* =========================
   TIMER (60 minutes)
   ========================= */
let timeLeft = 60 * 60; // seconds
const timerEl = document.getElementById('timer');
const timerInterval = setInterval(()=>{
  if(timeLeft <= 0){
    clearInterval(timerInterval);
    timerEl.textContent = 'Time left: 00:00';
    document.getElementById('quizForm').requestSubmit();
    return;
  }
  const m = Math.floor(timeLeft/60).toString().padStart(2,'0');
  const s = (timeLeft%60).toString().padStart(2,'0');
  timerEl.textContent = `Time left: ${m}:${s}`;
  timeLeft--;
}, 1000);

/* =========================
   NAV CONTROLS (separate from submit)
   ========================= */
document.getElementById('toTop').onclick = ()=>window.scrollTo({top:0,behavior:'smooth'});
document.getElementById('toBottom').onclick = ()=>window.scrollTo({top:document.body.scrollHeight,behavior:'smooth'});

function firstUnansweredIndex(step=+1){
  const total = questions.length;
  let start = 0;
  // check current viewport roughly
  const qs = [...document.querySelectorAll('.q')];
  const mid = window.scrollY + window.innerHeight/2;
  let near = 0;
  qs.forEach((el,idx)=>{
    const r = el.getBoundingClientRect();
    const y = r.top + window.scrollY;
    if (y < mid) near = idx;
  });
  start = near;
  for(let k=1;k<=total;k++){
    const i = ((start + step*k) % total + total) % total;
    if(!document.querySelector(`input[name="q${i}"]:checked`)) return i;
  }
  return -1;
}
document.getElementById('nextUnanswered').onclick = ()=>{
  const idx = firstUnansweredIndex(+1);
  if(idx>=0) document.querySelectorAll('.q')[idx].scrollIntoView({behavior:'smooth',block:'center'});
};
document.getElementById('prevUnanswered').onclick = ()=>{
  const idx = firstUnansweredIndex(-1);
  if(idx>=0) document.querySelectorAll('.q')[idx].scrollIntoView({behavior:'smooth',block:'center'});
};

/* =========================
   SUBMIT / SCORE / HIGHLIGHT / SEND WRONGS
   ========================= */
const form = document.getElementById('quizForm');
const result = document.getElementById('result');
const breakdown = document.getElementById('breakdown');
const failedNumbersEl = document.getElementById('failedNumbers');
const failedListEl = document.getElementById('failedList');

form.addEventListener('submit', async (e)=>{
  e.preventDefault();
  clearInterval(timerInterval);

  const name = document.getElementById('studentName').value.trim();
  if(!name){ alert('Please enter student name'); return; }

  // Confirm before final submission
  const ok = confirm('Are you sure you want to submit your answers?');
  if(!ok) return;

  // Gather answers and score
  const formData = new FormData(form);
  let score = 0;
  const total = questions.length;
  const wrongs = []; // for sending
  const failedNumbers = [];

  // Clear old highlighting
  document.querySelectorAll('.answers label').forEach(l => {
    l.classList.remove('correct','wrong');
  });

  for(let i=0;i<questions.length;i++){
    const given = formData.get(`q${i}`);
    const correct = questions[i].a;

    // highlight selection + correct
    const labels = [...document.querySelectorAll(`input[name="q${i}"]`)].map(inp=>inp.parentElement);
    labels.forEach(lbl=>{
      const val = lbl.querySelector('input').value;
      if(val === correct){
        addTag(lbl,'Correct');
        lbl.classList.add('correct');
      }
    });

    if(given === correct){
      score++;
    }else{
      failedNumbers.push(i+1);
      const wrongLabel = document.querySelector(`input[name="q${i}"]:checked`)?.parentElement;
      if(wrongLabel){
        addTag(wrongLabel,'Your choice');
        wrongLabel.classList.add('wrong');
      }
      wrongs.push({
        number: i+1,
        question: questions[i].q,
        your_answer: given ?? "(no answer)",
        correct_answer: correct
      });
    }
  }

  // Show result to student
  result.textContent = `${name}: You scored ${score} / ${total}.`;

  // Show exactly which questions were failed
  if(wrongs.length){
    breakdown.hidden = false;
    failedNumbersEl.textContent = `You missed these question numbers: ${failedNumbers.join(', ')}.`;
    failedListEl.innerHTML = '';
    wrongs.forEach(w=>{
      const li = document.createElement('li');
      li.innerHTML = `<strong>Q${w.number}.</strong> ${escapeHtml(w.question)}<br>
        <em>Your answer:</em> ${escapeHtml(w.your_answer)}<br>
        <em>Correct answer:</em> ${escapeHtml(w.correct_answer)}`;
      failedListEl.appendChild(li);
    });
  }else{
    breakdown.hidden = false;
    failedNumbersEl.textContent = 'Perfect! You did not miss any question.';
    failedListEl.innerHTML = '';
  }

  // Prepare payload: only wrong answers + summary
  const payload = {
    student_name: name,
    score: `${score}/${total}`,
    failed_numbers: failedNumbers.join(', '),
    wrong_count: wrongs.length,
    wrongs // only failed questions with correct answers
  };

  // Send to Formspree (teacher email)
  try {
    await fetch('https://formspree.io/f/mvgqwywl', {
      method:'POST',
      headers: {'Content-Type':'application/json'},
      body: JSON.stringify({
        subject: `Basic Tech Quiz — ${name} — ${score}/${total}`,
        message: `Student: ${name}\nScore: ${score}/${total}\nFailed numbers: ${payload.failed_numbers || 'None'}`,
        payload
      })
    });
    const note = document.createElement('div');
    note.className='note';
    note.textContent = 'Only the failed questions have been sent to the teacher email.';
    result.appendChild(document.createElement('br'));
    result.appendChild(note);
  } catch(err) {
    const warn = document.createElement('div');
    warn.className='warn';
    warn.textContent = 'Could not send results to email (network/CORS). Your score and feedback are shown above.';
    result.appendChild(document.createElement('br'));
    result.appendChild(warn);
    console.error(err);
  }
});

// Add a small tag to a label ("Correct" / "Your choice")
function addTag(label, text){
  // avoid duplicates
  if(label.querySelector('.tag')) return;
  const span = document.createElement('span');
  span.className = 'tag';
  span.style.marginLeft = '6px';
  span.textContent = `(${text})`;
  label.appendChild(span);
}

// Accessibility: jump to first unanswered on invalid
form.addEventListener('invalid', function(ev){
  ev.preventDefault();
  for(let i=0;i<questions.length;i++){
    if(!document.querySelector(`input[name="q${i}"]:checked`)){
      const el = document.querySelector(`input[name="q${i}"]`);
      if(el){ el.scrollIntoView({behavior:'smooth',block:'center'}); el.focus(); }
      break;
    }
  }
}, true);

// Escape helper
function escapeHtml(s){ return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
</script>
</body>
</html>

  

